<!DOCTYPE html>
<html>
    <head>

        <!-- Bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        
         <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    </head>
    <body>
        <div class="bg-light text-center p-5 mb-4">
            <h2>Choose an option:</h2>
            <label for="limit">Limit:</label>
            <input id="limit" type="number" min=1 max=5 value=1>
            <select onchange="getData()" id="type">
                <option value="customers">Customers</option>
                <option value="products">Products</option>
                <option value="suppliers">Suppliers</option>
            </select>
            
        </div>
        <div id="result">

        </div>
        <script>
            function getData() {
        
                const itemType = document.getElementById("type").value;
                const limit = document.getElementById("limit").value;
                
                axios.get("/data", {
                            params:{
                                type: itemType,
                                limit: limit
                            }
                        })
                .then(response => {
                    console.log(response.data['records'])
                    generateTable(response.data)
                    
    

                })
                .catch(error =>{
                    console.log(error.message)
                })

            
            }
        
        function generateTable(dataObj) {

            const resultDivElem = document.getElementById("result")
            while(resultDivElem.firstChild){
                resultDivElem.firstChild.remove()
            }
            const h2Elem = document.createElement("h2");
            h2Elem.innerText = dataObj["type"];
            resultDivElem.appendChild(h2Elem);

            const tableElement = document.createElement("table");
            tableElement.className = "table";

            //insert table headers

            const theadElement = document.createElement("thead");
            tableElement.appendChild(theadElement);

            

            const obj_keys = Object.keys(dataObj['records'][0]);
            const trElement = document.createElement("tr")
            for (i=0; i < obj_keys.length; i++){
                const thElement = document.createElement("th")
                thElement.textContent = obj_keys[i];
                thElement.scope = "col";
                trElement.appendChild(thElement);
            }
            theadElement.appendChild(trElement);

            // instert table data
            
            const tbodyElement = document.createElement("thead");
            tableElement.appendChild(tbodyElement);

            for (i=0; i < dataObj['records'].length; i++) {
                const trElement = document.createElement("tr");
                for (x=0; x < obj_keys.length; x++){
                    const tdElement = document.createElement("td");
                    tdElement.textContent = dataObj['records'][i][obj_keys[x]]
                    tdElement.scope = "col";
                    trElement.appendChild(tdElement);
                }
                tbodyElement.appendChild(trElement);
            }
            tableElement.appendChild(tbodyElement);

            resultDivElem.appendChild(tableElement);
        }
                    
                    
                    
        </script>
</body>
</html>